@page "/seller/dashboard"
@model SD.ProjectName.WebApp.Pages.Seller.DashboardModel
@{
    ViewData["Title"] = "Seller dashboard";
}

<h1 data-testid="seller-dashboard-heading">Seller dashboard</h1>
<p class="text-muted">Welcome to your seller area.</p>

@if (!string.IsNullOrWhiteSpace(Model.StatusMessage))
{
    <div class="alert alert-info" data-testid="seller-status">
        @Model.StatusMessage
    </div>
}

<div class="card mt-3">
    <div class="card-body">
        <h5 class="card-title">Store profile</h5>
        <p class="card-text">Manage the store information buyers see on your public page.</p>
        <div class="d-flex gap-2">
            <a class="btn btn-primary" asp-page="/Seller/Store" data-testid="store-settings-link">Manage store profile</a>
            @if (!string.IsNullOrWhiteSpace(Model.PublicStoreUrl))
            {
                <a class="btn btn-outline-secondary" href="@Model.PublicStoreUrl" target="_blank" rel="noopener" data-testid="dashboard-store-link">View public page</a>
            }
        </div>
    </div>
</div>

<div class="card mt-3">
    <div class="card-body">
        <h5 class="card-title">Payout settings</h5>
        <p class="card-text">Update your bank account details and default payout method.</p>
        @if (Model.HasPayoutDetails)
        {
            <p class="text-muted small mb-2">
                Default method: @Model.PayoutDefaultMethod
                @if (!string.IsNullOrWhiteSpace(Model.MaskedPayoutAccount))
                {
                    <span class="ms-2" data-testid="dashboard-payout-account">Account: @Model.MaskedPayoutAccount</span>
                }
            </p>
            @if (Model.LatestPayout is not null)
            {
                <div class="mt-2" data-testid="dashboard-payout-status">
                    <div class="small text-muted">Latest payout</div>
                    <div class="fw-semibold">@Model.LatestPayout.StatusLabel</div>
                    <div class="text-muted small">
                        Amount @Model.LatestPayout.Amount.ToString("C") · Scheduled @Model.LatestPayout.ScheduledFor.ToString("yyyy-MM-dd")
                        @if (!string.IsNullOrWhiteSpace(Model.LatestPayout.ErrorReference) && Model.LatestPayout.Status == SD.ProjectName.Modules.Cart.Domain.PayoutStatus.Failed)
                        {
                            <span class="text-danger ms-1">Error: @Model.LatestPayout.ErrorReference</span>
                        }
                    </div>
                </div>
            }
            else
            {
                <p class="text-muted small mb-2">No payouts scheduled yet.</p>
            }
        }
        else
        {
            <p class="text-muted small mb-2">Add payout details to enable transfers.</p>
        }
        <div class="d-flex gap-2">
            <a class="btn btn-primary" asp-page="/Seller/Payout" data-testid="payout-settings-link">Manage payout settings</a>
            <a class="btn btn-outline-secondary" asp-page="/Seller/Payouts/Index" data-testid="payout-history-link">View payout history</a>
        </div>
    </div>
</div>

@if (Model.SellerUserManagementEnabled)
{
    <div class="card mt-3">
        <div class="card-body">
            <h5 class="card-title">Team access</h5>
            <p class="card-text">Invite and manage internal users and roles for your store.</p>
            <a class="btn btn-primary" asp-page="/Seller/Users" data-testid="seller-users-link">Manage team</a>
        </div>
    </div>
}
